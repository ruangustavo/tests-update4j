<?xml version="1.0"?>
<!DOCTYPE protocol SYSTEM "application/src/main/resources/protocols-config.dtd">
<protocol name="TRADICIONAL" type="TRI">
    <Command> <!-- key="G" alias="MedidoresEstado">  -->
        <key>G1</key> <!-- FASE R -->
        <alias>MedidoresEstadoTrifasico</alias><!--  usedby="TRI"> -->
        <description>Resgata medidores e status do UPS</description>

        <!-- Pattern: ‘G’ 1h Xh Xh Xh Ck <CR> -->

        <Request beanType="ComandoNobreak">
            <param name="Comando" type="binary" value="71"/>
            <param name="Param1" type="binary" value="1"/>
            <param name="Param2" type="binary" value="-1"/>
            <param name="Param3" type="binary" value="-1"/>
            <param name="Param4" type="binary" value="-1"/>
            <param name="Check" type="check" calc="(({Comando})+({Param1})+({Param2})+({Param3})+({Param4}))*-1"/>
        </Request>

        <!-- Pattern: H IH IL BH BL OH OL PH PL FH FL AH AL RH RL B1 CK <CR>
                      3a09f6089804f600640258032000fa20320d-->

        <Response beanType="MedidorEstadoTrifasicoBean" validation="true" start="2">
            <param name="TensaoEntradaR" size="4" type="hexa" calc="{TensaoEntradaR}/10"/>
            <param name="TensaoBypassR" size="4" type="hexa" calc="{TensaoBypassR}/10"/>
            <param name="TensaoSaidaR" size="4" type="hexa" calc="{TensaoSaidaR}/10"/>
            <param name="PotenciaSaidaR" size="4" type="hexa" calc="{PotenciaSaidaR}/10"/>
            <param name="FrequenciaEntrada" size="4" type="hexa" calc="{FrequenciaEntrada}/10"/>
            <param name="CorrenteBateria" size="4" type="hexa" calc="{CorrenteBateria}/10"/>
            <param name="reservado" size="4" type="string" ignore="true"/>
            <param name="EstadoBateria" size="2" type="binary" ignore="true"/>
            <param name="FalhaRecarregador" size="1" type="boolean" start="0" refs="EstadoBateria"/>
            <param name="FaseInvertida" size="1" type="boolean" start="1" refs="EstadoBateria"/>
            <param name="BateriaBaixaCritica" size="1" type="boolean" start="2" refs="EstadoBateria"/>
            <param name="SobreCarga" size="1" type="boolean" start="3" refs="EstadoBateria"/>
            <param name="SobreTemperatura" size="1" type="boolean" start="4" refs="EstadoBateria"/>
            <param name="FalhaInversor" size="1" type="boolean" start="5" refs="EstadoBateria"/>
            <param name="FaltaRede" size="1" type="boolean" start="6" refs="EstadoBateria"/>
            <param name="DefeitoFontePrincipal" size="1" type="boolean" start="7" refs="EstadoBateria"/>
            <!-- <validation required="true"/> -->
        </Response>
    </Command>

    <Command> <!-- key="G2" alias="MedidoresEstado">  -->
        <key>G2</key> <!-- FASE S -->
        <alias>MedidoresEstadoTrifasico</alias><!--  usedby="TRI"> -->
        <description>Resgata medidores e status do UPS</description>

        <!-- Pattern: ‘G’ 2h Xh Xh Xh Ck <CR> -->

        <Request beanType="ComandoNobreak">
            <param name="Comando" type="binary" value="71"/>
            <param name="Param1" type="binary" value="2"/>
            <param name="Param2" type="binary" value="-1"/>
            <param name="Param3" type="binary" value="-1"/>
            <param name="Param4" type="binary" value="-1"/>
            <param name="Check" type="check" calc="(({Comando})+({Param1})+({Param2})+({Param3})+({Param4}))*-1"/>
        </Request>

        <!-- Pattern: H IH IL BH BL OH OL PH PL FH FL RH RL RH RL B2 CK <CR>
                      3a00ff089804f600640258032000fa71e10d-->

        <Response beanType="MedidorEstadoTrifasicoBean" validation="true" start="2">
            <param name="TensaoEntradaS" size="4" type="hexa" calc="{TensaoEntradaS}/10"/>
            <param name="TensaoBypassS" size="4" type="hexa" calc="{TensaoBypassS}/10"/>
            <param name="TensaoSaidaS" size="4" type="hexa" calc="{TensaoSaidaS}/10"/>
            <param name="PotenciaSaidaS" size="4" type="hexa" calc="{PotenciaSaidaS}/10"/>
            <param name="FrequenciaBypass" size="4" type="hexa" calc="{FrequenciaBypass}/10"/>
            <!-- O EstadoBateria não será carregado no bean, portanto tem o atributo ignore="true"
                 este servirá para o cálculo dos outros atributos
-->
            <param name="reservado" size="8" type="string" ignore="true"/>
            <param name="EstadoBateria" size="2" type="binary" ignore="true"/>
            <param name="VinAnormal" size="1" type="boolean" start="0" refs="EstadoBateria"/>
            <param name="VbpAnormal" size="1" type="boolean" start="1" refs="EstadoBateria"/>
            <param name="VoutAnormal" size="1" type="boolean" start="2" refs="EstadoBateria"/>
            <param name="FreqBpAnormal" size="1" type="boolean" start="3" refs="EstadoBateria"/>
            <param name="SaidaBypass" size="1" type="boolean" start="4" refs="EstadoBateria"/>
            <param name="EmergenciaAcionada" size="1" type="boolean" start="5" refs="EstadoBateria"/>
            <param name="BateriaBaixa" size="1" type="boolean" start="6" refs="EstadoBateria"/>
            <param name="ChaveBypassManual" size="1" type="boolean" start="7" refs="EstadoBateria"/>
            <!-- <validation required="true"/> -->
        </Response>
    </Command>

    <Command> <!-- key="G" alias="MedidoresEstado">  -->
        <key>G3</key> <!-- FASE T -->
        <alias>MedidoresEstadoTrifasico</alias><!--  usedby="TRI"> -->
        <description>Resgata medidores e status do UPS</description>

        <!-- Pattern: G 3h Xh Xh Xh Ck <CR> -->

        <Request beanType="ComandoNobreak">
            <param name="Comando" type="binary" value="71"/>
            <param name="Param1" type="binary" value="3"/>
            <param name="Param2" type="binary" value="-1"/>
            <param name="Param3" type="binary" value="-1"/>
            <param name="Param4" type="binary" value="-1"/>
            <param name="Check" type="check" calc="(({Comando})+({Param1})+({Param2})+({Param3})+({Param4}))*-1"/>
        </Request>

        <!-- Pattern: H IH IL BH BL OH OL PH PL FH FL RH RL RH RL B3 CK <CR>
                      3a00ff089804f600640258032000fa71e10d-->

        <Response beanType="MedidorEstadoTrifasicoBean" validation="true" start="2">
            <param name="TensaoEntradaT" size="4" type="hexa" calc="{TensaoEntradaT}/10"/>
            <param name="TensaoBypassT" size="4" type="hexa" calc="{TensaoBypassT}/10"/>
            <param name="TensaoSaidaT" size="4" type="hexa" calc="{TensaoSaidaT}/10"/>
            <param name="PotenciaSaidaT" size="4" type="hexa" calc="{PotenciaSaidaT}/10"/>
            <param name="FrequenciaSaida" size="4" type="hexa" calc="{FrequenciaSaida}/10"/>
            <param name="reservado" size="8" type="string" ignore="true"/>
            <param name="EstadoBateria" size="2" type="binary" ignore="true"/>
            <param name="SaidaMonofasica" size="1" type="boolean" start="0" refs="EstadoBateria"/>
            <param name="ChestInversor" size="1" type="boolean" start="2" refs="EstadoBateria"/>
            <param name="EntradaTriangulo" size="1" type="boolean" start="3" refs="EstadoBateria"/>
            <param name="SaidaTriangulo" size="1" type="boolean" start="4" refs="EstadoBateria"/>
            <param name="LogEventos" size="1" type="boolean" start="5" refs="EstadoBateria"/>
            <!-- <validation required="true"/> -->
        </Response>
    </Command>

    <Command> <!-- key="Q" alias="MedidoresEstado"> -->
        <key>G1</key>
        <alias>MedidoresEstadoDefault</alias><!-- usedby="MONO, TRI"> -->
        <description>Resgata um bean com os valores pré-definidos para os medidores e status do UPS</description>
        <!-- Pattern: ‘Q’ Xh Xh Xh Xh CK <CR> -->
        <Request beanType="MedidorEstadoTrifasicoBean">
            <param name="TensaoBypassR" size="1" type="string" value="0"/>
            <param name="TensaoBypassS" size="1" type="string" value="0"/>
            <param name="TensaoBypassT" size="1" type="string" value="0"/>
            <param name="PotenciaSaidaR" size="1" type="string" value="0"/>
            <param name="PotenciaSaidaS" size="1" type="string" value="0"/>
            <param name="PotenciaSaidaT" size="1" type="string" value="0"/>
            <param name="TensaoEntradaR" size="1" type="string" value="0"/>
            <param name="TensaoEntradaS" size="1" type="string" value="0"/>
            <param name="TensaoEntradaT" size="1" type="string" value="0"/>
            <param name="TensaoSaidaR" size="1" type="string" value="0"/>
            <param name="TensaoSaidaS" size="1" type="string" value="0"/>
            <param name="TensaoSaidaT" size="1" type="string" value="0"/>
            <param name="FrequenciaEntrada" size="1" type="string" value="0"/>
            <param name="FrequenciaBypass" size="1" type="string" value="0"/>
            <param name="FrequenciaSaida" size="1" type="string" value="0"/>
            <param name="CorrenteBateria" size="1" type="string" value="0"/>
        </Request>
    </Command>

    <Command>
        <key>X</key>
        <alias>DumpLog</alias>
        <description>Gera Dump Log</description>
        <Request beanType="DumpLogBean">
            <param name="Comando" type="binary" value="88"/>
        </Request>
    </Command>

    <!-- ######################### Parametros Comuns (Monofasico e trifasico)#########################################
-->

    <Command> <!-- key="Q" alias="MedidoresEstado">  -->
        <key>Q</key>
        <alias>MedidoresEstado</alias><!--  usedby="MONO, TRI"> -->
        <description>Resgata medidores e status do UPS</description>
        <!-- Pattern: ‘Q’ Xh Xh Xh Xh CK <CR> -->
        <Request beanType="ComandoNobreak">
            <param name="Comando" type="binary" value="81"/>
            <param name="Param1" type="binary" value="-1"/>
            <param name="Param2" type="binary" value="-1"/>
            <param name="Param3" type="binary" value="-1"/>
            <param name="Param4" type="binary" value="-1"/>
            <param name="Check" type="check" calc="(({Comando})+({Param1})+({Param2})+({Param3})+({Param4}))*-1"/>
        </Request>
        <!-- Pattern: H ZH ZL MH ML PH PL QH QL RH RL SH SL TH TL Bh CK <CR>
                      3d005a46a002582ffffffbc2449ffffffdfd-->
        <Response beanType="MedidorEstadoBean" validation="true">
            <param name="Tipo" size="2" type="hexa"/>
            <!-- validvalues="[\x3C|\x3D|\x3E]"/> -->
            <!-- Value: \x3C	-> Sinal de menor que "<"
                 Value: \x3D	-> Sinal de igual "="
                 Value: \x3E	-> Sinal de maior que ">"
-->
            <param name="UltimaTensao" size="4" type="hexa" calc="{UltimaTensao}/10"/>
            <param name="TensaoEntrada" size="4" type="hexa" calc="{TensaoEntrada}/10"/>
            <param name="TensaoSaida" size="4" type="hexa" calc="{TensaoSaida}/10"/>
            <param name="PotenciaSaida" size="4" type="hexa" calc="{PotenciaSaida}/10"/>
            <param name="FrequenciaSaida" size="4" type="hexa" calc="{FrequenciaSaida}/10"/>
            <param name="PorcentagemTensaoBateria" size="4" type="hexa" calc="{PorcentagemTensaoBateria}"/>
            <param name="Temperatura" size="4" type="hexa" calc="{Temperatura}/10"/>
            <!-- O EstadoBateria não será carregado no bean, portanto tem o atributo ignore="true"
                 este servirá para o cálculo dos outros atrobutos
-->
            <param name="EstadoBateria" size="2" type="binary" ignore="true"/>
            <param name="BeepLigado" size="1" type="boolean" start="7" refs="EstadoBateria"/>
            <param name="ShutdownAtivo" size="1" type="boolean" start="6" refs="EstadoBateria"/>
            <param name="TesteAtivo" size="1" type="boolean" start="5" refs="EstadoBateria"/>
            <param name="UpsOk" size="1" type="boolean" start="4" refs="EstadoBateria"/>
            <param name="Boost" size="1" type="boolean" start="3" refs="EstadoBateria"/>
            <param name="ByPass" size="1" type="boolean" start="2" refs="EstadoBateria"/>
            <param name="BateriaBaixa" size="1" type="boolean" start="1" refs="EstadoBateria"/>
            <param name="BateriaLigada" size="1" type="boolean" start="0" refs="EstadoBateria"/>
            <!-- param name="Check" size="2" type="string" ignore="true" />
            <param name="CR" size="2" ignore="true" type="string"/
-->
            <!-- <validation required="true"/> -->
        </Response>
    </Command>

    <Command>
        <key>I</key>
        <alias>Informacoes</alias>
        <description>Resgata informações do UPS</description>
        <Request beanType="ComandoNobreak">
            <!-- Pattern: ‘I’ Xh Xh Xh Xh CK <CR> -->
            <param name="Comando" type="binary" value="73"/>
            <param name="Param1" type="binary" value="-1"/>
            <param name="Param2" type="binary" value="-1"/>
            <param name="Param3" type="binary" value="-1"/>
            <param name="Param4" type="binary" value="-1"/>
            <param name="Check" type="check" calc="(({Comando})+({Param1})+({Param2})+({Param3})+({Param4}))*-1"/>
        </Request>
        <Response beanType="InformacoesBean" start="2" validation="true">
            <!-- Pattern: H M M M M M M M M M M M M V V V CK <CR> -->
            <param name="Modelo" size="24" type="hexaString"/>
            <param name="Versao" size="6" type="hexaString"/>
            <!-- <validation required="false"/> -->
        </Response>
    </Command>

    <Command>
        <key>I</key>
        <alias>InformacoesDefault</alias>
        <description>Resgata informações do UPS</description>
        <Request beanType="InformacoesBean">
            <param name="Modelo" size="1" type="String" value=""/>
            <param name="Versao" size="1" type="String" value=""/>
        </Request>
    </Command>

    <Command>
        <key>F</key>
        <alias>Caracteristicas</alias>
        <description>Resgata características do UPS</description>
        <Request beanType="ComandoNobreak">
            <!-- Pattern: ‘F’ Xh Xh Xh Xh CK <CR> -->
            <param name="Comando" type="binary" value="70"/>
            <param name="Param1" type="binary" value="-1"/>
            <param name="Param2" type="binary" value="-1"/>
            <param name="Param3" type="binary" value="-1"/>
            <param name="Param4" type="binary" value="-1"/>
            <param name="Check" type="check" calc="(({Comando})+({Param1})+({Param2})+({Param3})+({Param4}))*-1"/>
        </Request>
        <Response beanType="CaracteristicasBean" start="2" validation="true">
            <!-- Pattern: H M M M M M M M Q Q Q S S S R R CK <CR> -->
            <param name="FaixaTensao" size="14" type="String"/>
            <param name="FaixaCorrente" size="6" type="String"/>
            <param name="TensaoBateria" size="6" type="String"/>
            <param name="Frequencia" size="4" type="String"/>
            <!-- <param name="CR" size="2" ignore="true" type="string"/ -->
        </Response>
    </Command>

    <!-- ################################################# Disparos #################################################
-->

    <Command>
        <key>M</key>
        <alias>MudaBeep</alias>
        <description>Muda o beep</description>
        <Request beanType="ComandoNobreak">
            <!-- Pattern: ‘M’ Xh Xh Xh Xh CK <CR> -->
            <param name="Comando" type="binary" value="77"/>
            <param name="Param1" type="binary" value="-1"/>
            <param name="Param2" type="binary" value="-1"/>
            <param name="Param3" type="binary" value="-1"/>
            <param name="Param4" type="binary" value="-1"/>
            <param name="Check" type="check" calc="(({Comando})+({Param1})+({Param2})+({Param3})+({Param4}))*-1"/>
        </Request>
        <!--
            <Response>
                This command has no response
            </Response>
        -->
    </Command>

    <Command>
        <key>L</key>
        <alias>TesteBateriaBaixa</alias>
        <description>Teste até bateria baixa</description>
        <Request beanType="ComandoNobreak">
            <!-- Pattern: ‘L’ Xh Xh Xh Xh CK <CR> -->
            <param name="Comando" type="binary" value="76"/>
            <param name="Param1" type="binary" value="-1"/>
            <param name="Param2" type="binary" value="-1"/>
            <param name="Param3" type="binary" value="-1"/>
            <param name="Param4" type="binary" value="-1"/>
            <param name="Check" type="check" calc="(({Comando})+({Param1})+({Param2})+({Param3})+({Param4}))*-1"/>
        </Request>
        <!--
            <Response>
                This command has no response
            </Response>
        -->
    </Command>

    <Command>
        <key>T</key>
        <alias>TestePorSegundos</alias>
        <description>Teste por 'n' segundos</description>
        <Request beanType="ComandoNobreak">
            <!-- Pattern: ‘T’ NH NL Xh Xh CK <CR> -->
            <param name="Comando" type="binary" value="84"/>
            <param name="Param1" type="binary" value="a"/>
            <param name="Param2" type="binary" value="b"/>
            <param name="Param3" type="binary" value="-1"/>
            <param name="Param4" type="binary" value="-1"/>
            <param name="Check" type="check" calc="(({Comando})+({Param1})+({Param2})+({Param3})+({Param4}))*-1"/>
        </Request>
        <!--
            <Response>
                This command has no response
            </Response>
        -->
    </Command>

    <Command>
        <key>S</key>
        <alias>ShutdownPorSegundos</alias>
        <description>Shutdown em n segundos</description>
        <Request beanType="ComandoNobreak">
            <!-- Pattern: ‘S’SH SL Xh Xh CK <CR> -->
            <param name="Comando" type="binary" value="83"/>
            <param name="Param1" type="binary" value="-1"/>
            <param name="Param2" type="binary" value="-1"/>
            <param name="Param3" type="binary" value="-1"/>
            <param name="Param4" type="binary" value="-1"/>
            <param name="Check" type="check" calc="(({Comando})+({Param1})+({Param2})+({Param3})+({Param4}))*-1"/>
        </Request>
    </Command>

    <Command>
        <key>R</key>
        <alias>ShutdownRestore</alias>
        <description>Shutdown e restore</description>
        <Request beanType="ComandoNobreak">
            <!-- Pattern: ‘R’ SH SL RH RL CK <CR> -->
            <param name="Comando" type="binary" value="82"/>
            <param name="Param1" type="binary" value="-1"/>
            <param name="Param2" type="binary" value="-1"/>
            <param name="Param3" type="binary" value="-1"/>
            <param name="Param4" type="binary" value="-1"/>
            <param name="Check" type="check" calc="(({Comando})+({Param1})+({Param2})+({Param3})+({Param4}))*-1"/>
        </Request>
    </Command>

    <Command>
        <key>D</key>
        <alias>CancelarTeste</alias>
        <description>Cancelamento de Teste</description>
        <Request beanType="ComandoNobreak">
            <!-- Pattern: ‘D’ Xh Xh Xh Xh CK <CR> -->
            <param name="Comando" type="binary" value="68"/>
            <param name="Param1" type="binary" value="-1"/>
            <param name="Param2" type="binary" value="-1"/>
            <param name="Param3" type="binary" value="-1"/>
            <param name="Param4" type="binary" value="-1"/>
            <param name="Check" type="check" calc="(({Comando})+({Param1})+({Param2})+({Param3})+({Param4}))*-1"/>
        </Request>
        <!--
            <Response>
                This command has no response
            </Response>
        -->
    </Command>

    <Command>
        <key>C</key>
        <alias>CancelarShutdownRestore</alias>
        <description>Cancelamento de Shutdown ou restore</description>
        <Request beanType="ComandoNobreak">
            <!-- Pattern: ‘C’ Xh Xh Xh Xh CK <CR> -->
            <param name="Comando" type="binary" value="67"/>
            <param name="Param1" type="binary" value="-1"/>
            <param name="Param2" type="binary" value="-1"/>
            <param name="Param3" type="binary" value="-1"/>
            <param name="Param4" type="binary" value="-1"/>
            <param name="Check" type="check" calc="(({Comando})+({Param1})+({Param2})+({Param3})+({Param4}))*-1"/>
        </Request>
        <!--
            <Response>
                This command has no response
            </Response>
        -->
    </Command>
</protocol>